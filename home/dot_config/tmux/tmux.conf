# Enable colours
set -g default-terminal 'xterm-256color'
set -as terminal-overrides ',xterm*:Tc:sitm=\E[3m'

# Prefix key
unbind C-b
set -g prefix2 C-space
bind C-space send-prefix

# Fix Home/End
bind -n Home send Escape "OH"
bind -n End send Escape "OF"

# Options
set -g base-index 1
setw -g pane-base-index 1

setw -g automatic-rename on
set -g renumber-windows on

set -g set-titles on
set -g set-titles-string "#W"

set -g display-panes-time 800
set -g display-time 1000

set -g monitor-activity on
set -g visual-activity off

# Enable mouse
set -g mouse on

# Scrollback
set -g history-limit 50000

# Use emacs keys in command prompt
set -g status-keys emacs

# Neovim checkhealth recommendations
set -sg escape-time 10
set -g focus-events on

# Vim motions
set-window-option -g mode-keys vi
# bind Enter copy-mode # enter copy mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection
# bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send -X cancel

# Copy to clipboard
# if -b '! command -v xsel > /dev/null 2>&1 && command -v xclip > /dev/null 2>&1' 'bind y run -b "\"\$TMUX_PROGRAM\" \${TMUX_SOCKET:+-S \"\$TMUX_SOCKET\"} save-buffer - | xclip -i -selection clipboard >/dev/null 2>&1"'

# Open new windows in current directory path
bind c new-window -c "#{pane_current_path}"

# Easier and faster switching between windows
# bind C-p previous-window
# bind C-n next-window
bind C-Space next-window

# Split Windows
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind _ split-window -h -c "#{pane_current_path}"
unbind '"'
bind - split-window -v -c "#{pane_current_path}"

bind -r m resize-pane -Z

bind e set-window-option synchronize-panes

# Reload config
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "󰑓 Config reloaded"

# melange colorscheme
status_bg="#34302c"
status_fg="#c1a78e"
info_bg="#867462"
info_fg="${status_bg}"
border_fg="${info_bg}"
active_fg="${status_fg}"
session_bg="${status_fg}"
session_fg="${status_bg}"
message_bg="${status_bg}"
message_fg="${status_fg}"
current_bg="${session_bg}"
current_fg="${status_bg}"
window_bg="${status_bg}"
window_fg="${status_fg}"
select_bg="${status_bg}"
select_fg="${status_fg}"

# Status bar
set -g status-position top
set -g status-justify absolute-centre
set -g status-style bg="${status_bg}",fg="${status_fg}"

set -g status-left-length 60
set -g status-left "#[fg=${session_fg},bg=${session_bg}]  #S #[fg=${session_bg},bg=${status_bg}]"

set -g status-right-length 120
set -g status-right "#[fg=${info_bg},bg=${status_bg}]#{?mouse, ,}#{?pane_synchronized, ,}#{?window_zoomed_flag,󰖯 ,}#[fg=${info_bg},bg=${status_bg}]#[fg=${info_fg},bg=${info_bg}]  #{cpu_percentage}  #{cpu_temp} #[fg=${session_bg},bg=${info_bg}]#[fg=${session_fg},bg=${session_bg}] #(whoami)@#H "

# Window format
set -g window-status-format "#[fg=${window_fg}]   #I:#W  "
set -g window-status-current-format "#[fg=${current_bg},bg=${status_bg}]#[fg=${current_fg},bg=${current_bg},bold]  #I:#W #[fg=${current_bg},bg=${status_bg}]"
set -g window-status-separator ""

# Message bar
set -g message-style bg="${message_bg}",fg="${message_fg},bold"

# Borders
set -g pane-border-style fg="${border_fg}"
set -g pane-active-border-style fg="${active_fg}"

# Selection
set -g mode-style bg="${select_bg}",fg="${select_fg}"

# Pop-Up: Session list
bind w display-popup -E -w 30% -h 50% ~/.config/tmux/scripts/tmux-menu.sh
bind s display-popup -E -w 30% -h 50% ~/.config/tmux/scripts/tmux-menu.sh

# Pop-Up: Terminal
bind -n C-t display-popup -E -w 100% -h 100% ~/.config/tmux/scripts/tmux-term.sh
bind -T popup t send-keys t  # send 't' as a regular keystroke (prevent close)
bind -T popup q send-keys q  # send 'q' as a regular keystroke (prevent close)
bind -T popup C-t detach
bind -T popup C-[ copy-mode
unbind -T popup Tab

# Pop-Up: LazyGit
bind g display-popup -d "#{pane_current_path}" -E -w 100% -h 100% -E lazygit

# Plugins https://github.com/tmux-plugins/list
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'christoomey/vim-tmux-navigator'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @vim_navigator_mapping_left "C-Left"
set -g @vim_navigator_mapping_right "C-Right"
set -g @vim_navigator_mapping_up "C-Up"
set -g @vim_navigator_mapping_down "C-Down"

# Auto save / restore
# set -g @resurrect-capture-pane-contents 'on'
# set -g @continuum-restore 'on'
# set -g @continuum-save-interval '1'

# Initialize TPM
run '~/.config/tmux/plugins/tpm/tpm'
